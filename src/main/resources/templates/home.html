<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta content="text/css; charset=UTF-8; X-Content-Type-Options=nosniff" http-equiv="Content-Type" />
    <title>Repoph &mdash; Home</title>

    <link href="../static/assets/img/logo.png" rel="icon"/>
    <link href="../static/assets/img/logo.png" rel="apple-touch-icon"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="../static/assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <style>
        .sidebar-item {
            position: absolute;
        }

        .make-me-sticky {
            position: -webkit-sticky;
            position: sticky;
            top: 15%;
        }
        .home-footer-area{
            -webkit-box-shadow: 0px -4px 5px 0px rgba(0,0,0,0.25);
            -moz-box-shadow: 0px -4px 5px 0px rgba(0,0,0,0.25);
            box-shadow: 0px -4px 5px 0px rgba(0,0,0,0.25);
        }
        .js-is-hidden {
            display: none;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="../static/css/home.css" />
</head>
<body>
<nav class="navbar d-flex sticky-top flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm navbar-expand-sm text-danger">
    <a class="navbar-brand my-0 mr-md-auto font-weight-normal" href="/home">
        <img src="../static/assets/img/repoph_flat_nav_logo.png" height="50" width="200" alt="logo">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-list-4" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <nav class="navbar navbar-expand-sm" sec:authorize="isAuthenticated()">
        <div class="collapse navbar-collapse dropleft" id="navbar-list-4">
            <ul class="navbar-nav">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#abd" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <img src="https://cdn2.iconfinder.com/data/icons/rcons-user/32/male-fill-circle-512.png" width="30" height="30" class="rounded-circle bx-border-circle">
                    </a>
                    <div class="dropdown-menu" id="abd" aria-labelledby="navbarDropdownMenuLink">
                        <h6 class="dropdown-header"  th:if="${userType.equals('sp') || userType.equals('spFh')} " th:text="${activeUsername+' ( Service Provider )'}">Rakul preat singh ( Service Provider )</h6>
                        <h6 class="dropdown-header"  th:if="!${userType.equals('sp') || userType.equals('spFh')}" th:text="${activeUsername+' ( Service Consumer )'}">Rakul preat singh ( Service Provider )</h6>
                        <small class="dropdown-header" th:text="${#authentication.getName()}" >example234@gmail.com</small>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item bx-burst-hover" href="/home">Home</a>
                        <a class="dropdown-item bx-burst-hover" href="/profile">Dashboard</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item bx-burst-hover text-danger" href="/logout">Log Out</a>
                    </div>
                </li>
            </ul>
        </div>
    </nav>
    <span sec:authorize="!isAuthenticated()">
                <a class="btn btn-outline-primary mr-2" href="/login">Log in</a>
                <a class="btn btn-outline-primary" href="/registration">Sign up</a>
        </span>
</nav>
<div class="wrapper">
    <aside class="sidebar-left">
        <div class="list-group">
            <div class="container">
                <div class="row">
                    <aside class="col-sm-12">
                        <div class="card">
                            <article class="card-group-item">
                                <header class="card-header"><h6 class="title">Pricing filter</h6></header>
                                <div class="filter-content">
                                    <div class="list-group list-group-flush">
                                        <a  href="" onclick="setUrl('price','299')" class="list-group-item"> < Below 299 &#8377;<span
                                                class="float-right badge badge-light round">142</span> </a>
                                        <a href="" onclick="setUrl('price','599')" class="list-group-item"> < Below 599 &#8377;<span
                                                class="float-right badge badge-light round">3</span> </a>
                                        <a href="" onclick="setUrl('price','999')" class="list-group-item"> < Below 999 &#8377;<span
                                                class="float-right badge badge-light round">32</span> </a>
                                        <a href="" onclick="setUrl('price','2999')" class="list-group-item"> < Below 2999 &#8377;<span
                                                class="float-right badge badge-light round">12</span> </a>
                                        <a href="" onclick="setUrl('price','4999')" class="list-group-item"> < Below 4999 &#8377;<span
                                                class="float-right badge badge-light round">6</span> </a>
                                    </div>  <!-- list-group .// -->
                                </div>
                            </article>
                            <article class="card-group-item">
                                <header class="card-header">
                                    <h6 class="title"> Sort by </h6>
                                </header>
                                <div class="filter-content">
                                    <div class="card-body">
                                        <label class="form-check">
                                            <input class="form-check-input" type="radio" name="exampleRadio" value="" onclick="setUrl('sortBy','price')">
                                            <span class="form-check-label"> Pricing </span>
                                        </label>
                                        <label class="form-check">
                                            <input class="form-check-input" type="radio" name="exampleRadio" value="" onclick="setUrl('sortBy','ratings')">
                                            <span class="form-check-label"> Ratings </span>
                                        </label>
                                        <label class="form-check">
                                            <input class="form-check-input" type="radio" name="exampleRadio" value="" onclick="setUrl('sortBy','free-soon')">
                                            <span class="form-check-label"> Free soon</span>
                                        </label>
                                        <label class="form-check">
                                            <input class="form-check-input" type="radio" name="exampleRadio" value="" onclick="setUrl('sortBy','skills-exp')">
                                            <span class="form-check-label"> Skills & Exp </span>
                                        </label>
                                    </div> <!-- card-body.// -->
                                </div>
                            </article> <!-- card-group-item.// -->
                        </div> <!-- card.// -->
                    </aside> <!-- col.// -->
                </div> <!-- row.// -->
<!--                <div class="row">-->
<!--                    <aside class="col-sm-12">-->
<!--                        <p>Filter 2</p>-->
<!--                        <div class="card">-->
<!--                            <article class="card-group-item">-->
<!--                                <header class="card-header">-->
<!--                                    <h6 class="title">Brands </h6>-->
<!--                                </header>-->
<!--                                <div class="filter-content">-->
<!--                                    <div class="card-body">-->
<!--                                        <form>-->
<!--                                            <label class="form-check">-->
<!--                                                <input class="form-check-input" type="checkbox" value="">-->
<!--                                                <span class="form-check-label">Mersedes Benz</span>-->
<!--                                            </label> &lt;!&ndash; form-check.// &ndash;&gt;-->
<!--                                            <label class="form-check">-->
<!--                                                <input class="form-check-input" type="checkbox" value="">-->
<!--                                                <span class="form-check-label">Nissan Altima</span>-->
<!--                                            </label>  &lt;!&ndash; form-check.// &ndash;&gt;-->
<!--                                            <label class="form-check">-->
<!--                                                <input class="form-check-input" type="checkbox" value="">-->
<!--                                                <span class="form-check-label">Another Brand</span>-->
<!--                                            </label>  &lt;!&ndash; form-check.// &ndash;&gt;-->
<!--                                        </form>-->

<!--                                    </div> &lt;!&ndash; card-body.// &ndash;&gt;-->
<!--                                </div>-->
<!--                            </article> &lt;!&ndash; card-group-item.// &ndash;&gt;-->
<!--                        </div> &lt;!&ndash; card.// &ndash;&gt;-->
<!--                    </aside> &lt;!&ndash; col.// &ndash;&gt;-->
<!--                </div>-->
<!--                <div class="row">-->
<!--                    <aside class="col-sm-12">-->
<!--                        <div class="card">-->
<!--                            <article class="card-group-item">-->
<!--                                <header class="card-header">-->
<!--                                    <h6 class="title"> Price filter </h6>-->
<!--                                </header>-->
<!--                                <div class="filter-content">-->
<!--                                    <div class="card-body">-->
<!--                                        <div class="form-row">-->
<!--                                            <div class="form-group col-md-6">-->
<!--                                                <label>Min</label>-->
<!--                                                <input type="number" class="form-control" id="inputEmail4"-->
<!--                                                       placeholder="$0">-->
<!--                                            </div>-->
<!--                                            <div class="form-group col-md-6 text-right">-->
<!--                                                <label>Max</label>-->
<!--                                                <input type="number" class="form-control" placeholder="$1,0000">-->
<!--                                            </div>-->
<!--                                        </div>-->
<!--                                    </div> &lt;!&ndash; card-body.// &ndash;&gt;-->
<!--                                </div>-->
<!--                            </article> &lt;!&ndash; card-group-item.// &ndash;&gt;-->
<!--                        </div> &lt;!&ndash; card.// &ndash;&gt;-->
<!--                    </aside> &lt;!&ndash; col.// &ndash;&gt;-->
<!--                </div>-->
            </div>
            <!--container end.//-->
        </div>
    </aside>
    <article class="content">
        <div class="container shadow-sm p-3 bg-white rounded">
            <div class="alert alert-warning action-alert" role="alert" th:if="${userType.equals('sp')}">
                <span><strong>Opps!</strong> seems you are not <strong>Service Consumer.</strong></span>
            </div>
            <form class="input-group mt-1 mb-5">
                <input type="text" class="form-control" placeholder="Search by name, title, skill....">
                <div class="input-group-append">
                    <button class="btn btn-secondary" type="button">
                        <i class="fa fa-search"></i>
                    </button>
                </div>
            </form>
            <div class="row" th:each="user: ${data}">
                <div class="col-12">
                    <div class="card shadow p-3 mb-5  bg-white rounded border-0">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-12 col-lg-8 col-md-6">
                                    <h3 class="mb-0 text-truncated" th:id="'name' + ${user.getId()}" th:text="${user.getFirstName()+' '+user.getLastName()}">Mike Anamendolla</h3>
                                    <p class="lead" th:id="'title' + ${user.getId()}" th:text="${user.getAbout().getTitle()}">Web / UI Designer</p>
                                    <p  class="card-text" th:text="${user.getAbout().getDescription()}">
                                        I love to read, hang out with friends, watch football, listen to music, and
                                        learn new things.
                                    </p>
                                    <p>
                                        <span th:each="skill: ${user.getSkills()}">
                                            <span class="badge badge-pill badge-light mt-1 h4">
                                                <small th:text="${skill.getSkillName()}">Java</small>&nbsp;
                                                <small class="badge badge-pill badge-success" th:if="!${skill.getExperience()<=12}" th:text="${#numbers.formatDecimal((skill.getExperience()/12.0), 0, 1)+' y'}">0</small>
                                                <small class="badge badge-pill badge-success" th:if="${skill.getExperience()<=12}" th:text="${(skill.getExperience()/1.0)+' m'}">0</small>
<!--                                                <small th:text="${user.averageScore} % 1 == 0? ${user.averageScore} :${#numbers.formatDecimal(user.averageScore, 0, 2)}"/> th:text="${(skill.getExperience()/12.0)+' y'}"-->
                                            </span>
                                        </span>
                                    </p>
                                </div>
                                <div class="col-12 col-lg-4 col-md-6 text-center">
                                    <img src="https://cdn2.iconfinder.com/data/icons/rcons-user/32/male-fill-circle-512.png"
                                         alt=""
                                         class="mx-auto rounded-circle img-fluid">
                                    <br>
                                    <ul class="list-inline ratings text-center" title="Ratings">
                                        <li>
                                            <div class="star-rating">
                                                <div class="back-stars">
                                                    <i class="fa fa-star m-1" aria-hidden="true"></i>
                                                    <i class="fa fa-star m-1" aria-hidden="true"></i>
                                                    <i class="fa fa-star m-1" aria-hidden="true"></i>
                                                    <i class="fa fa-star m-1" aria-hidden="true"></i>
                                                    <i class="fa fa-star m-1" aria-hidden="true"></i>

                                                    <div class="front-stars" style="width: 50%;">
                                                        <i class="fa fa-star m-1" aria-hidden="true"></i>
                                                        <i class="fa fa-star m-1" aria-hidden="true"></i>
                                                        <i class="fa fa-star m-1" aria-hidden="true"></i>
                                                        <i class="fa fa-star m-1" aria-hidden="true"></i>
                                                        <i class="fa fa-star m-1" aria-hidden="true"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                        <li>
                                            <i class="fa fa-users"></i>
                                            <small class="mb-0 text-info ">79</small> &nbsp; &nbsp;
                                            <small class="text-muted">ratings</small>
                                        </li>
                                        <li>
                                            <small>Pricing : <i class='fas fa-rupee-sign text-warning ml-2'></i>
                                            </small>
                                            <small class="ml-2" th:id="'price' + ${user.getId()}"
                                                   th:text="${user.getPricing()}">100</small>/day
                                        </li>
                                        <li th:if="${user.getEstimatedTime()!=0.0}">
                                            <small>
                                                <span class="text-info" > Will be free in : </span>
                                                <i class="fa fa-clock-o text-warning ml-1" aria-hidden="true"></i>
                                                <span class="ml-2" th:text="${user.getEstimatedTime()}">100</span> hours
                                            </small>

                                        </li>
                                    </ul>
                                </div>
                                <div class="col-12 col-lg-6">
                                    <small>Profile</small>
                                    <a  th:href="${'/public-profile/'+user.getId()}" class="btn btn-outline-warning btn-block"><span class="fa fa-user"></span>
                                        View Profile
                                    </a>
                                </div>
                                <div class="col-12 col-lg-6">
                                    <small>Status</small>
                                    <div th:if="${user.getHireStatus()}">
                                        <button class="btn btn-outline-primary btn-block active" disabled><span
                                                class="fa fa-check"></span> hired </button>
                                    </div>
                                    <div th:if="${!user.getHireStatus()}">
                                        <div th:if="${user.getGender()}" th:id="'hire-btn' + ${user.getId()}">
                                            <button type="button"  class="btn btn-outline-primary btn-block" th:onclick="'disableHireButton(\'hire-btn'+${user.getId()}+'\');'+'addItemToCart('+${user.getId()}+');'">
                                                <span class="fa fa-arrow-circle-right"></span> hire Him
                                            </button>
                                        </div>
                                        <div th:if="${!user.getGender()}" th:id="'hire-btn' + ${user.getId()}">
                                            <button type="button" class="btn btn-outline-primary btn-block" th:onclick="'disableHireButton(\'hire-btn'+${user.getId()}+'\');'+'addItemToCart('+${user.getId()}+');'">
                                                <span class="fa fa-arrow-circle-right"></span> hire Her
                                            </button>
                                        </div>

                                    </div>

                                </div>


                                <!--/col-->
                            </div>
                            <!--/row-->
                        </div>
                        <!--/card-block-->
                    </div>
                </div>
            </div>
        </div>
    </article>
    <aside class="sidebar-right sidebar-item">
        <div class="col-lg-12 col-md-12 col-sm-12 cart  make-me-sticky" id="cart">
            <div class="card ">
                <div class="card-body" style="padding: 0.70rem;">
                    <div class="card-header">
                        <h4>Your hiring</h4>
                    </div>
                </div>
                <div id="dynamic-row" class="overflow-auto" style="height: 350px">

                </div>
                <div class="card-footer">
                    <span>Grand Subtotal : ₹</span>&nbsp;&nbsp;&nbsp;<span id="grand">0</span>.00/day
                </div>
                <form id="list" action="/add-to-cart" method="post">
                    <div class="card-footer" id="action-btn">
                        <button  class="btn btn-outline-warning w-100" id="btn-conformation"
                                onclick="storeArrayInHiddenForm()" disabled>Conform
                        </button>
                    </div>
                </form>

            </div>
        </div>
    </aside>
</div>
    <footer class="pt-4 home-footer-area border-light mt-5">
        <div class="container">
            <div class="row">
                <div class="col-12 col-md">
                    <img class="m-3 rounded" src="../static/assets/img/repoph_flat_bg_logo.png" alt="" width="75"
                         height="75">
                    <small class="d-block ml-3 text-muted">&copy; 2020 - Now</small>
                </div>
                <div class="col-6 col-md">
                    <h5>Features</h5>
                    <ul class="list-unstyled text-small">
                        <li><a class="text-muted" href="#">Cool stuff</a></li>
                        <li><a class="text-muted" href="#">Random feature</a></li>
                        <li><a class="text-muted" href="#">Team feature</a></li>
                        <li><a class="text-muted" href="#">Stuff for developers</a></li>
                        <li><a class="text-muted" href="#">Another one</a></li>
                        <li><a class="text-muted" href="#">Last time</a></li>
                    </ul>
                </div>
                <div class="col-6 col-md">
                    <h5>Resources</h5>
                    <ul class="list-unstyled text-small">
                        <li><a class="text-muted" href="#">Resource</a></li>
                        <li><a class="text-muted" href="#">Resource name</a></li>
                        <li><a class="text-muted" href="#">Another resource</a></li>
                        <li><a class="text-muted" href="#">Final resource</a></li>
                    </ul>
                </div>
                <div class="col-6 col-md">
                    <h5>About</h5>
                    <ul class="list-unstyled text-small">
                        <li><a class="text-muted" href="#">Team</a></li>
                        <li><a class="text-muted" href="#">Locations</a></li>
                        <li><a class="text-muted" href="#">Privacy</a></li>
                        <li><a class="text-muted" href="#">Terms</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>


<!-- jQuery CDN - Slim version (=without AJAX) -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
</script>
<!-- Popper.JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
        integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous">
</script>
<!-- Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
        integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous">
</script>
<!-- jQuery Custom Scroller CDN -->
<script
        src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js">
</script>
<script>
    let users = [];
    let grandTotal = 0;

    function addItemToCart(id) {
        const name = document.getElementById("name" + id);
        const title = document.getElementById("title" + id);
        const price = document.getElementById("price" + id);

        const user = {
            "id": id,
            "name": name.innerHTML,
            "title": title.innerHTML,
            "price": price.innerHTML
        };
        users.unshift(user);
        displayItems();
        calGrandTotal();
        toggleConformationButton();
    }
    function displayItems() {
        const dynamicList = document.getElementById("dynamic-row");
        dynamicList.innerHTML = "";
        users.forEach(function (user) {
            dynamicList.innerHTML +=
                "<div class='container'>" +
                "    <div class='card-body '>" +
                "        <div class='row'>" +
                "           <div class='col-md-9'>" +
                        "        <span>" +
                        "            <i class='fa fa-user text-success' aria-hidden='true'></i>" +
                        "        </span>" +
                        "        <span class='name'>" + user.name +
                        "        </span><br><small><cite title='Title' class='text-muted'>("+ user.title+ ")</cite></small><br>" +
                        "                <span class='mr-2'>Price:</span>" +
                        "                 <span>₹ </span><span id='" + "cal-price" + user.id + "'>" + user.price + "</span>" +
                        "    </div>" +
                "            <div class='col-md-3'>" +
                "                 <button class='btn btn-outline-danger' onclick='" + "remove(" + user.id + ");'><i class='bx bxs-trash bx-tada '  aria-hidden='true'></i></button>" +
                "            </div>" +
                "         </div>" +
                "    </div>" +
                "    <hr/>" +
                "</div>";
        });

    }

    function calGrandTotal() {
        grandTotal = users.reduce((a, c) => {
            return a + parseFloat(c.price);
        }, 0);
        document.getElementById('grand').innerHTML = grandTotal;
        grandTotal = 0;
    }

    function storeArrayInHiddenForm() {
        const form = document.getElementById("list");
        if (form.getElementsByTagName("input").length <= 1) {
            users.forEach(function (user) {
                document.getElementById("list").innerHTML +=
                    "<input type='hidden' name='id' value='" + user.id + "'>";
            });
        }
        changePropertyOfConformButton();
    }

    function changePropertyOfConformButton() {
        let button = document.getElementById("btn-conformation");
        button.removeAttribute("onclick");
        button.setAttribute("type", "submit");
        button.innerHTML = "Continue";
        button.classList.remove('btn-outline-warning');
        button.classList.add('btn-outline-success');
    }


    function remove(id) {
        users = users.filter(usr => !(usr.id===id));
        enableHireButton('hire-btn'+id);
        displayItems();
        calGrandTotal();
        toggleConformationButton();
    }


    function toggleConformationButton() {
        if(users.length > 0) {
            document.getElementById("btn-conformation").disabled = false;
        } else  {
            document.getElementById("btn-conformation").disabled = true;
        }
    }

    function disableHireButton(addBtn) {
        document.getElementById(addBtn).firstElementChild.disabled = true;
    }

    function enableHireButton(addBtn) {
        document.getElementById(addBtn).firstElementChild.disabled = false;
    }

    let alert = document.querySelector(".action-alert");

    // Detect all clicks on the document
    document.addEventListener("click", function(event) {
        // If user clicks inside the element, do nothing
        console.log(alert);
        if (event.target.closest(".action-alert")) return;

        // If user clicks outside the element, hide it!
        alert.classList.add("js-is-hidden");
    });

    function setUrl(param, paramValue) {
        let params = new URLSearchParams(location.search);
        params.set(param, paramValue);
        window.history.replaceState({}, "", location.pathname + '?' + params);
        location.reload();
    }
</script>
</body>
</html>